# Ref

https://tachingchen.com/tw/blog/how-to-do-a-code-review-by-google-2/

# Overview

Design (設計)
Functionality (功能性)
Complexity (複雜性)
Tests (測試)
Naming (命名)
Comments (註釋)
Style (風格)
Documentation (文件)
Every Line (每一行程式)
Context (前後文)
Good Things (好事、優點)
Summary (總結)


# What to look for in a code review

考慮以下要點時，務必連同 The Standard of Code Review 一同考慮

# Design

程式審核裡最重要的一環是 CL 的整理設計

1. CL 內的多個程式之間的交互最用是否合理
2. 此次改動是否能和系統其他部分很好的整合?
3. 現在是加入該功能的適當時機嗎?

# Functionality

1. CL 是否真的有符合開發者意圖?
2. 開發者的意圖對於使用者(受到改動而影響 / 未來會用到該程式的人)
3. 多數情況下，我們會期望開發者徹底側使他們的 CL
   1. 身為審核者，你必須儘可能地思考 edge case, concurrenct problem, 並確保沒有明顯 bug
   2. 如果改動帶來直面使用者的影響(e.g. UI改動)，驗證 CL 的變化是審核者整個過程中最重要的事，如果面對此改動不方便自己測試，可以要求開發者Demo
   3. 如果 CL 中友 parallel programming ，必須審核是否存在 deadlocks / race conditions - 這類問題較難透過執行程式來察覺，通常會需要開發者和審核者一起仔細思考，確保問題不會被引入程式庫內

# Complexity

1. 一個 CL 是否複雜到超過原本所需的?
   * 針對任何層級的 CL 請務必確認這一點 - 單行程式是否過於複雜、函式是否過於複雜、Class 是否過於複雜

> 「複雜」通常代表著該程式很難快速被閱讀程式的人所理解

> 也意味著很有可能其他開發者在呼叫或修改這段程式時引入缺陷

其中一種複雜性便是 過度設計 (Over-engineering)，開發者會讓程式過度通用化 (more generic) 超過它原本所需的，或是新增現在系統不需要用到的功能 [1]。 審核者對於必須非常警惕過度設計的發生。

> 鼓勵開發者解決他們現在需要解決的問題，而非那些猜測未來可能會需要被解決的問題

可以在真正面臨到那些未來的問題時才解決它們，因屆時你才能更清晰看到問題的樣貌 (actual shape) 與需求。

# Test

* 單元 / 整合 / end to end
* 對應的測試是 正確、合理、有用的
* 是否是簡單有用的 assertions?

> 請記住，測試也是必須維護的程式。不要因為它們不包含在 main binary 內，

> 而接受測試程式中包含不必要的複雜性。

# Naming

開發者是否為每個的東西挑選恰當的名字


> 一個好的命名意謂著

> 長到足以完整表達該東西的作用或做什麼

> 同時不要長的難以閱讀。

# Comments

* 開發者是否用可理解的英文留下清晰地 comment?
* 這些 comment 是否真的必要?
* 通常解釋 why 比 what 更重要
  * 如果程式碼本身不能清楚解釋自己的話，意味著需要更加簡化
  * 但是正規表達式、複雜的演算法 - 解釋 what 是非常有用的

# Style

1. Google 對於主要語言有提供風格指南
2. 如果想改進 CL 中某些不包含在風格指南中的風格要點，請在評論前加上 `Nit:`
3. 開發者不應該在 CL 內同時包含其他程式碼修正以及風格調整
   1. 這樣會難以看出 CL 到底做出什麼更動，同時也讓 merge , rollback 變得更為複雜

# Doc

如果 CL 更改用戶如何「構建 (build)」、「測試」、「交互 (interact)」、「發布」程式的方法時，請檢查是否也同時更新相關文檔， 包括 READMEs，g3doc 頁面和其他生成 (generated) 的參考文件。如果 CL 刪除或棄用 (deprecate) 程式，請考慮是否應該刪除對應文檔，如果缺少文檔時請詢問。


# Every Line

> 仔細查看你被分配審核的 CL 的每一行程式

1. 有些東西，比如資料文件 (data files)、生成的程式 (generated code)、大型資料結構 (large data structures)，你可以稍微掃過。 千萬不要在掃過開發者寫的 class、函式、程式區塊 (block of code) 時，並假設其內部的內容是沒問題的。 很顯然的某些程式需要比其他程式更仔細的審查 (scrutiny) - 這是必須由你做出的判斷 (judgment call)。但至少你應該確定你理解所有程式在做些什麼。

2. 如果閱讀程式過於複雜並且減慢審核速度時，那麼你再繼續審核前要讓開發者知道這件事，並等待他們為程式做出解釋、澄清 (clarify)。 在 Google 我們聘請許多優秀的軟體工程師，而你也是其中的一員。如果連你也無法理解程式的話，很可能其他人也不會。 因此，你要求開發者去澄清此程式時，同時也在幫助未來的開發人員理解這些它們。

3. 如果你能夠理解程式但覺得沒有資格進行某部份的審核，請確保 CL 審核者中有一個適合 (合格) 的審核人來審核該部分。尤其是針對「安全性 (security)」、 「並發性 (concurrency)」、「可訪問性 (accessibility)」、「國際化 (internationalization)」等複雜問題時。

# Context

> 在充足的前後文 (broad context) 下查看 CL 通常很有幫助。

1. 一般來說，程式碼審查工具只會顯示修改部分周圍的幾行程式而已。但有時你必須查看整個文件以確保改動是否合理。 比方說，你可能只看到添加 4 行新程式碼，但實際上查看整個文件時會發現這 4 行是被加在有 50 行的函式裡，此時便需要將它拆解為更小的函式。
   *  以整個系統的角度出發來思考 CL 也是很有用的。該 CL 是否改善整體系統的程式品質，亦或是會讓整個系統更加複雜? 是否缺少測試? 千萬不要接受會降低整體系統程式品質運行狀況的 CL。因為大多數系統是由於許多小改動的積累而變得複雜，因此阻止新的改動引入複雜性 (儘管很小) 也非常重要。

# Good Things

> 當你在 CL 裡看到優點時記得告訴開發者，尤其是當他們用很棒的方式來解決你的評論時。

1. 程式審查通常只關注在錯誤，但它們也應該同時應該為良好實踐 (good practices) 提供鼓勵與欣賞。 這點在指導 (mentoring) 開發者時尤其重要: 比告訴告訴他們做錯了什麼，更好的是告訴他們做對什麼 
   * 多以鼓勵來代替指出錯誤」，讓其他開發者更有動力想將事情做好。 其實透過簡單的一句話讓對方知道哪裡做得很好，未來他們會將繼續保持下去，並為其他開發者帶來的正面影響 

# Summary

在進行程式審核時，請務必確保

程式經過完善的設計

功能性對於使用者們是好的

對於任何 UI 改動要合理且合眼 (look good)

任何平行程式設計 (parallel programming) 的實現是安全

程式不應該複雜超過原本所必須的

開發者不該實現一個現在不用而未來可能 (might) 需要的功能

程式有適當的單元測試

測試經過完善的設計

開發者對於每樣東西有使用清晰、明瞭的命名

註釋要清楚且有用，並只用來解釋「為什麼存在 (why)」而非「做什麼 (what)」

程式有適當的寫下文件 (一般在 g3doc)

程式符合風格指南

確保你查看被要求審核的每一行程式碼、確認上下文 (context)、確保你正在改善程式品質，並讚揚開發人員所做的好事與優點吧!
